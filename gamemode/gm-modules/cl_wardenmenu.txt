
surface.CreateFont("WMFontBig", {
    font = "Roboto",
    size = 28,
    weight = 800
})
surface.CreateFont("WMFontMed", {
    font = "Roboto",
    size = 18
})

concommand.Add("jb_openwardenmenu", function()
    if IsValid(wyodr.WardenPanel) then
        wyodr.WardenPanel:Remove()
    end
    
    wyodr.WardenPanel = vgui.Create("DPanel")
    wyodr.WardenPanel:SetPos(10, ScrH()/2-200)
    wyodr.WardenPanel:SetSize(230, 400)
    
    local wp = wyodr.WardenPanel
    
    wp.ClosePanel = function(self) 
        local _, y = self:GetPos()
        self:MoveTo(-300, y, 1, 0, 0.5, function() self:Remove() end)
    end
    
    local function lbl(txt, font, x, y)
        local lbl = vgui.Create("DLabel", wp)
        lbl:SetFont(font)
        lbl:SetPos(x, y)
        lbl:SetSize(200, 25)
        lbl:SetColor(Color(0, 0, 0))
        if type(txt) == "function" then
            lbl.Think = function(pself) pself:SetText(txt()) end
        else
            lbl:SetText(txt)
        end
    end
    
    local function btn(tbl)
        local btn = vgui.Create("DButton", wp)
        btn:SetText("")
        btn.BaseColor = tbl.clr or Color(41, 128, 185)
        btn.Paint = function(pself, w, h)
            if pself:GetDisabled() then
                surface.SetDrawColor(200, 200, 200, 200)
            elseif pself.Hovered then
                local h,s,v = ColorToHSV(pself.BaseColor)
                surface.SetDrawColor(HSVToColor(h,s+0.1,v))
            else
                surface.SetDrawColor(pself.BaseColor)
            end
            surface.DrawRect(0, 0, w, h)
            
            draw.SimpleText(type(tbl.txt) == "function" and tbl.txt() or tbl.txt, "WMFontMed", w/2, h/2, Color(255, 255, 255), TEXT_ALIGN_CENTER, TEXT_ALIGN_CENTER)
        end
        btn:SetPos(tbl.x, tbl.y)
        btn:SetSize(200, 35)
        btn.Think = function(pself)
            if tbl.enable_fn then pself:SetDisabled(not tbl.enable_fn()) end
        end
        
        if tbl.tool then btn:SetToolTip(tbl.tool) end
        
        btn.DoClick = function() tbl.fn() end
    end
    
    lbl("Warden Menu", "WMFontBig", 43, 10)
    
    lbl("Hold TAB to click on buttons", "WMFontMed", 15, 37)
    
    btn {
        txt="Give Freeday",
        x=15, y=68,
        fn=function()
            local menu = DermaMenu()
            for _,ply in pairs(player.GetAll()) do
                if ply:Team() == TEAM_RUNNER and ply:Alive() and not ply:GetNWBool("Freeday", false) then
                    menu:AddOption(ply:Nick(), function()
                        net.Start("GiveFreeday")
                            net.WriteEntity(ply)
                        net.SendToServer()
                    end)
                end
            end
            menu:Open()
        end
    }
    
    btn {
        txt="Start Event",
        x=15, y=113,
        fn=function()
            local menu = DermaMenu()
            menu:AddOption("Zombie freeday", function() RunConsoleCommand("zombiefreeday") end)
            menu:Open()
        end,
        enable_fn=function() return LocalPlayer():IsSupporter() end
    }
    
    btn {
        txt="Close",
        x=15, y=350,
        clr = Color(192, 57, 43),
        fn=function()
            wp:ClosePanel()
        end
    }

    local endt = CurTime()+20
    lbl(function() return string.format("(automatically closes in %02d)", math.ceil(endt-CurTime())) end, "WMFontMed", 20, 325)
    
    hook.Add("ScoreboardShow", "MouseCapWardenMenu", function()
        if not IsValid(wp) then return end
        wp:SetMouseInputEnabled(true)
    end)
    hook.Add("ScoreboardHide", "MouseCapWardenMenu", function()
        if not IsValid(wp) then return end
        wp:SetMouseInputEnabled(false)
    end)
    
    timer.Simple(20, function()
        if IsValid(wp) then wp:ClosePanel() end
    end)
end)

hook.Add("WardenElected", "OpenWardenMenu", function(warden)
    if warden == LocalPlayer() then
        RunConsoleCommand("jb_openwardenmenu")
    end
end)

--if LocalPlayer():IsSuperAdmin() then
--    RunConsoleCommand("jb_openwardenmenu")
--end