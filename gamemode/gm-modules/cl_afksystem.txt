local lastmovement
local afkwarnings = 0
local function AfkWarn()
	chat.AddText(Color(255, 0, 0), "Moving you to AFK if you don't move soon!")
	afkwarnings = afkwarnings + 1
end

timer.Create("afkchecker", 1, 0, function()
	local me = LocalPlayer()
	if not IsValid(me) then return end
	
	local pos, ang = me:GetPos(), me:EyeAngles()

	if not me:Alive() or me:Team() == TEAM_SPECTATOR or me:GetMoonMode() then
		lastmovement = nil
	elseif not lastmovement or lastmovement.pos ~= pos or lastmovement.ang ~= ang then
		lastmovement = lastmovement or {}
		lastmovement.pos = pos
		lastmovement.ang = ang
		lastmovement.time = CurTime()
		afkwarnings = 0
	end
	
	if lastmovement then
		local elapsed = CurTime() - lastmovement.time
		if elapsed > 60 and afkwarnings == 0 then
			AfkWarn()
		elseif elapsed > 80 and afkwarnings == 1 then
			AfkWarn()
		elseif elapsed > 90 and afkwarnings == 2 then
			AfkWarn()
		end
		if me:Alive() and elapsed > 100 then
			chat.AddText("We seem to be AFK, moving to spec..")
			net.Start("teamChange")
			net.WriteUInt(TEAM_SPECTATOR, 8)
			net.SendToServer()
		end
	end
end)