
if SERVER then
    util.AddNetworkString("GiveFreeday")
    net.Receive("GiveFreeday",function(len,player)
        local target = net.ReadEntity()
        if IsValid(target) and player == GetGlobalEntity("Warden") and player:Alive() and player:Team() == TEAM_DEATH then
            if player.FreedaysGiven and player.FreedaysGiven > 5 then
                player:ChatPrint("TOO MANY FREEDAYS")
                timer.Simple(60*15, function() if IsValid(player) then player.FreedaysGiven = 0 end end)
                return
            end
            player.FreedaysGiven = (player.FreedaysGiven or 0) + 1
            player:IncrAchStat("freedaysgiven")
            target:SetNWBool("Freeday",true)
            wyodr.Notify("Warden "..player:Nick().." gave "..target:Nick().." a freeday")
        end
    end)
    
    
    hook.Add("RoundEnd","removeFreedays",function()
        for k,v in pairs(player.GetAll()) do
            v:SetNWBool("Freeday",false)
        end
    end)

end

if CLIENT then
    hook.Add("PostPlayerDraw", "DrawFreeDayText", function(ply)
        if ply == LocalPlayer() then return end
        if not ply:GetNWBool("Freeday", false) then return end
        
        if not ply:Alive() then return end
        
        local offset = Vector(0, 0, 79)
        local ang = LocalPlayer():EyeAngles()
        local pos = ply:GetPos() + offset + ang:Up()
        
        ang:RotateAroundAxis(ang:Forward(), 90)
        ang:RotateAroundAxis(ang:Right(), 90)
        
        cam.Start3D2D(pos, Angle(0, ang.y, 90), 0.5)
        draw.DrawText("FREEDAY", "WMFontBig", 2, 2, HSVToColor(((ply:EntIndex() + CurTime()*0.1)%1)*360, 0.5, 0.95), TEXT_ALIGN_CENTER)
        cam.End3D2D()    
    end)
end
