	local wardenPool = {}
function VoteMenu()
	local DermaPanel = vgui.Create( "DFrame" )
		DermaPanel:SetSize( 170, 250 )
		DermaPanel:SetTitle( "Warden election. [5]" )
		DermaPanel:SetVisible( true )
		DermaPanel:SetDraggable( false )
		DermaPanel:ShowCloseButton( false )
		DermaPanel:Center()
		DermaPanel:AlignLeft( 10 )
		DermaPanel.Paint = function()
			draw.RoundedBox( 8, 0, 0, DermaPanel:GetWide(), DermaPanel:GetTall(), Color( 0, 0, 0, 150 ) )
		end
		
		local timeout = CurTime()
			timer.Create("timeoutvotederma",1,5,function()
				if not DermaPanel:IsValid() then timer.Destroy("timeoutvotederma") return end
				DermaPanel:SetTitle( "Warden election. ["..math.Round(5 - (CurTime() - timeout)).."]" )
			end)
 
	local DermaList = vgui.Create( "DPanelList", DermaPanel )
		DermaList:SetPos( 15,25 )
		DermaList:SetSize( 200, 200 )
		DermaList:SetSpacing( 5 ) -- Spacing between items
		DermaList:EnableHorizontal( false ) -- Only vertical items
		DermaList:EnableVerticalScrollbar( true ) -- Allow scrollbar if you exceed the Y axis
	
	for k,v in pairs(team.GetPlayers(TEAM_DEATH)) do
		if v:GetNWBool("WardenPool") then
			if k <= 10 then
				table.insert(wardenPool,v)
			end
		end
	end
		for k,v in pairs(wardenPool) do
			local addvote = vgui.Create("DLabel", DermaPanel)
				addvote:SetText(k..".            "..v:Nick())
				DermaList:AddItem( addvote )
				local av = vgui.Create("AvatarImage", addvote)
					av:SetPos(15,0)
					av:SetSize(22, 22)
					av:SetPlayer( v, 22 )
			
		end
			
	DermaList:SetSize(DermaList:GetWide(),(1 + #wardenPool) * 25)
	DermaPanel:SetSize(DermaPanel:GetWide(),(1 + #wardenPool) * 25)
	
	
	if #DermaList:GetItems() < 2 then
		DermaPanel:Close()
		timer.Destroy("timeoutvotederma")
	end
	
	timer.Simple(5.3,function()
		if DermaPanel:IsValid() then DermaPanel:Close() end
		if wyodr.GetRoundState() ~= ROUND_ACTIVE then return end
		ShowWarden()
	end)
	
	function CloseVoteMenu()
		if DermaPanel:IsValid() then DermaPanel:Close() timer.Destroy("timeoutvotederma") end
	end
end

local function VoteForWarden(id)
	if id == 0 then id = 10 end
	if wardenPool[id] ~= nil and wardenPool[id]:IsValid() then
	    net.Start("WardenVote")
			net.WriteEntity(wardenPool[id])
	    net.SendToServer()
	    CloseVoteMenu()
	    return true	
	end
end


hook.Add("RoundStart","WardenVote",function()
	table.Empty(wardenPool)
	VoteMenu()
	if #wardenPool < 1 then return end
	LocalPlayer():AddPlayerOption("Warden Vote",5,VoteForWarden,function() end)
end)

local matid = Material("ejb/id.png", "smooth")
surface.CreateFont("WardenNameFont", {
	font = "Roboto",
	size = 26,
	weight = 800
})
surface.CreateFont("WardenNameFontSmall", {
	font = "Roboto",
	size = 16,
	weight = 800
})
surface.CreateFont("WardenInfoFont", {
	font = "Roboto",
	size = 30,
	weight = 800
})

local is_kill_frac = 0

hook.Add("HUDPaint", "DrawWardenId", function()
	if not IsValid(wyodr.WardenAvatar) then
		wyodr.WardenAvatar = vgui.Create("AvatarImage")
		wyodr.WardenAvatar:ParentToHUD()
	end

	local warden = GetGlobalEntity("Warden")
	if (not IsValid(warden)) or GetGlobalBool("WardenActive") == false or warden:Team() ~= TEAM_DEATH then wyodr.WardenAvatar:SetVisible(false) return end
	wyodr.WardenAvatar:SetVisible(true)
	if warden ~= wyodr.WardenAvatar.Ply then
		wyodr.WardenAvatar:SetPlayer(warden, 64)
		wyodr.WardenAvatar.Ply = warden
	end
	
	is_kill_frac = math.Approach(is_kill_frac, warden:Alive() and 1 or 0, 0.01)
	
	surface.SetDrawColor(255, is_kill_frac*255, is_kill_frac*255, 50)
	surface.DrawRect(20, 17, 217, 105)
	
	
	wyodr.WardenAvatar:SetPos(36, 26)
	wyodr.WardenAvatar:SetSize(64, 64)
	wyodr.WardenAvatar:SetPaintedManually(false)
	wyodr.WardenAvatar:PaintManual()
	wyodr.WardenAvatar:SetPaintedManually(true)
	
	surface.SetDrawColor(255, 255, 255)
	surface.SetMaterial(matid)
	surface.DrawTexturedRect(2, 5, 256, 127)
	surface.SetFont("WardenNameFont")
	local TWidth, THeight = surface.GetTextSize(warden:Nick())
	if TWidth < 230 then
	    draw.SimpleTextOutlined(warden:Nick(), "WardenNameFont", 35, 90, Color(255, 255, 255), TEXT_ALIGN_BOTTOM, nil, 2, Color(0, 0, 0))
	else
	    draw.SimpleTextOutlined(warden:Nick(), "WardenNameFontSmall", 35, 97, Color(255, 255, 255), TEXT_ALIGN_BOTTOM, nil, 2, Color(0, 0, 0))
	end
	draw.SimpleTextOutlined("WARDEN", "WardenInfoFont", 166, 25, Color(255, 255, 255), TEXT_ALIGN_CENTER, nil, 2, Color(0, 0, 0))
	
		if not warden:Alive() then
			draw.SimpleTextOutlined("IS KILL", "WardenInfoFont", 166, 55, Color(255, 30, 30), TEXT_ALIGN_CENTER, nil, 2, Color(0, 0, 0))
		end
	
	draw.NoTexture()
end)

function ShowWarden()
	--[[	local DermaPanel = vgui.Create( "DFrame" )
	DermaPanel:SetAlpha(0)
	DermaPanel:SetSize( 75, 90 )
	DermaPanel:SetPos( 10, 10 )
	DermaPanel:SetTitle("")
	DermaPanel:SetVisible( true )
	DermaPanel:SetDraggable( false )
	DermaPanel:ShowCloseButton( false )
	--DermaPanel:MoveTo( 0, 0, 2, 0, 2)
	DermaPanel:AlphaTo(255,1,0)
	DermaPanel.Paint = function()
		if GetGlobalEntity("Warden") ~= nil and GetGlobalEntity("Warden"):IsValid() then
			draw.RoundedBox( 0, 0, 0, DermaPanel:GetWide(), DermaPanel:GetTall(), Color( 0, 0, 0, 100 ) )
			draw.SimpleText("Warden","WardenText",38,20,Color(255, 255, 255), TEXT_ALIGN_CENTER, TEXT_ALIGN_TOP)
			draw.SimpleText(GetGlobalEntity("Warden"):Nick(), "WardenText", 36, 72, Color(255, 255, 255), TEXT_ALIGN_CENTER)
		end
	end
	DermaPanel:ParentToHUD()
	if GetGlobalEntity("Warden") ~= nil and GetGlobalEntity("Warden"):IsValid() then
				local av = vgui.Create("AvatarImage", DermaPanel)
			av:SetPos(12,22)
			av:SetSize(48, 48)
			av:SetPlayer( GetGlobalEntity("Warden"), 64 )
	end

	hook.Add("RoundEnd","CloseWardenImageEnd",function()
		if DermaPanel:IsValid() then DermaPanel:Close() end
	end)
	
	hook.Add("RoundStart","CloseWardenImageStart",function()
		if DermaPanel:IsValid() then DermaPanel:Close() end
	end)]]

end

